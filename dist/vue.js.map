{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/initState.js","../src/proxy.js","../src/initMixin.js","../src/index.js"],"sourcesContent":["import { observe } from \"./index\";\n\nconst oldArrayProto = Array.prototype;\n\nexport const newArrayProto = Object.create(oldArrayProto);\n\nconst methods = [\n  \"push\",\n  \"pop\",\n  \"shift\",\n  \"unshift\",\n  \"reserve\",\n  \"sort\",\n  \"splice\",\n];\n\nmethods.forEach((method) => {\n  newArrayProto[method] = function (...args) {\n    const res = oldArrayProto[method].call(this, ...args);\n\n    const ob = this.__ob__;\n\n    let addItems = [];\n    switch (method) {\n      case \"push\":\n      case \"unshift\":\n        addItems = args;\n        break;\n      case \"splice\":\n        addItems = args.slice(2);\n        break;\n      default:\n        break;\n    }\n    ob.observeArray(addItems);\n\n    return res;\n  };\n});\n","import { newArrayProto } from \"./array\";\n\nclass Observer {\n  constructor(data) {\n\n    Object.defineProperty(data,'__ob__',{\n      value:this,\n      enumerable:false\n    })\n    if (Array.isArray(data)) {\n      this.observeArray(data)\n    } else {\n      this.walk(data);\n    }\n  }\n\n  walk(data) {\n    Object.keys(data).forEach((key) => {\n      defineReactive(data, key, data[key]);\n    });\n  }\n\n  observeArray(data){\n\n    data.__proto__ = newArrayProto\n\n    data.forEach(item=>observe(item))\n\n  }\n}\n\nexport const defineReactive = function (target, key, value) {\n  // 递归\n  observe(value);\n\n  Object.defineProperty(target, key, {\n    get() {\n      return value;\n    },\n    set(newVal) {\n      if (newVal === value) return;\n      observe(newVal);\n      value = newVal;\n    },\n  });\n};\n\nexport const observe = function (data) {\n\n  if (typeof data !== \"object\" || data === null) {\n    return;\n  }\n\n  if(data.__ob__){\n    return data.__ob__\n  }\n  \n  new Observer(data);\n};\n","import { observe } from \"./observe/index.js\";\n\nexport const initState = function (vm) {\n  let data = vm.$options.data;\n  data = typeof data === \"function\" ? data.call(vm) : data;\n  vm._data = data;\n\n  observe(data)\n};\n","export const proxy = function (vm, targetKey) {\n  const target = vm[targetKey];\n\n  if (typeof target !== \"object\" || target === null) {\n    return;\n  }\n\n  Object.keys(target).forEach((key) => {\n    Object.defineProperty(vm, key, {\n      get() {\n        return target[key];\n      },\n      set(newVal) {\n        if (target[key] === newVal) return;\n        target[key] = newVal;\n      },\n    });\n  });\n};\n","import { initState } from \"./initState\";\nimport { proxy } from \"./proxy\";\n\nexport const initMixin = function (Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    vm.$options = options;\n\n    // 数据劫持\n    initState(vm);\n\n    // 数据代理\n    proxy(vm, \"_data\");\n  };\n};\n","import { initMixin } from \"./initMixin\";\n\nfunction Vue(options) {\n  this._init(options);\n}\n\ninitMixin(Vue);\n\nexport default Vue;\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","res","call","ob","__ob__","addItems","slice","observeArray","Observer","data","defineProperty","value","enumerable","isArray","walk","keys","key","defineReactive","__proto__","item","observe","target","get","set","newVal","initState","vm","$options","_data","proxy","targetKey","initMixin","Vue","_init","options"],"mappings":"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"}